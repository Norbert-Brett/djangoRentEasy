{% extends 'base.html' %} {% load humanize %} {% block title %} | {{ listing.title }} {% endblock %} {% block content %}
<div class="bg-gray-50 dark:bg-gray-900 min-h-screen">
  <!-- Hero Section with Breadcrumb -->
  <section
    class="relative py-20 flex items-center justify-center bg-gradient-to-br from-slate-900 via-emerald-950/20 to-slate-900 overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
      <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="listing-grid" width="10" height="10" patternUnits="userSpaceOnUse">
            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5" />
          </pattern>
        </defs>
        <rect width="100" height="100" fill="url(#listing-grid)" />
      </svg>
    </div>

    <!-- Floating Elements -->
    <div class="absolute top-10 left-20 w-32 h-32 bg-emerald-500/10 rounded-full blur-xl"></div>
    <div class="absolute bottom-10 right-20 w-48 h-48 bg-teal-500/10 rounded-full blur-2xl"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <!-- Breadcrumb -->
      <nav class="flex justify-center mb-6" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-2 bg-white/10 backdrop-blur-md rounded-full px-4 py-2">
          <li class="inline-flex items-center">
            <a href="{% url 'index' %}"
              class="inline-flex items-center text-sm font-medium text-white/80 hover:text-white transition-colors duration-200">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                </path>
              </svg>
              Home
            </a>
          </li>
          <li>
            <div class="flex items-center">
              <svg class="w-5 h-5 text-white/60" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                  clip-rule="evenodd"></path>
              </svg>
              <a href="{% url 'listings' %}"
                class="ml-1 text-sm font-medium text-white/80 hover:text-white transition-colors">Browse Listings</a>
            </div>
          </li>
          <li>
            <div class="flex items-center">
              <svg class="w-5 h-5 text-white/60" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                  clip-rule="evenodd"></path>
              </svg>
              <span class="ml-1 text-sm font-medium text-white">Property Details</span>
            </div>
          </li>
        </ol>
      </nav>

      <!-- Property Header -->
      <div class="text-center">
        <div
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-emerald-100/90 dark:bg-emerald-900/40 text-emerald-800 dark:text-emerald-200 rounded-full mb-4 backdrop-blur-md">
          <i class="bi bi-house-star"></i>
          {{ listing.category|default:"Premium Residence" }}
        </div>

        <h1 class="text-3xl lg:text-4xl font-bold text-white mb-4 leading-tight">
          {{ listing.title }}
        </h1>

        <div class="flex items-center justify-center space-x-6 text-gray-300 mb-6">
          <div class="flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            {{ listing.city }}, {{ listing.country }}
          </div>
          <div class="flex items-center">
            <svg class="w-5 h-5 mr-2 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
            4.8 (24 reviews)
          </div>
          <div class="flex items-center">
            <span class="text-2xl font-bold text-white">£{{ listing.price|intcomma }}</span>
            <span class="text-gray-400 ml-1">/ night</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Alerts -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-4 relative z-20">
    {% include 'partials/_alerts.html' %}
  </div>

  <!-- Image Gallery -->
  <section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 rounded-2xl overflow-hidden">
        <!-- Main Image -->
        <div class="lg:col-span-2 lg:row-span-2">
          <div class="relative h-96 lg:h-full group cursor-pointer" onclick="openLightbox(0)">
            <img src="{{ listing.photo_main.url }}" alt="{{ listing.title }}"
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
              onerror="this.onerror=null; this.src='https://picsum.photos/seed/main_{{ listing.id }}/1200/800'" />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div>
            <div class="absolute bottom-4 left-4">
              <span
                class="inline-flex items-center px-3 py-1 bg-white/90 backdrop-blur-sm rounded-full text-sm font-medium text-gray-900">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                  </path>
                </svg>
                View All Photos
              </span>
            </div>
          </div>
        </div>

        <!-- Secondary Images -->
        {% if listing.photo_1 %}
        <div class="relative h-48 group cursor-pointer" onclick="openLightbox(1)">
          <img src="{{ listing.photo_1.url }}" alt="{{ listing.title }}"
            class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"
            onerror="this.onerror=null; this.src='https://picsum.photos/seed/p1_{{ listing.id }}/800/600'" />
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300 rounded-lg">
          </div>
        </div>
        {% endif %} {% if listing.photo_2 %}
        <div class="relative h-48 group cursor-pointer" onclick="openLightbox(2)">
          <img src="{{ listing.photo_2.url }}" alt="{{ listing.title }}"
            class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"
            onerror="this.onerror=null; this.src='https://picsum.photos/seed/p2_{{ listing.id }}/800/600'" />
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300 rounded-lg">
          </div>
        </div>
        {% endif %} {% if listing.photo_3 %}
        <div class="relative h-48 group cursor-pointer" onclick="openLightbox(3)">
          <img src="{{ listing.photo_3.url }}" alt="{{ listing.title }}"
            class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"
            onerror="this.onerror=null; this.src='https://picsum.photos/seed/p3_{{ listing.id }}/800/600'" />
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300 rounded-lg">
          </div>
        </div>
        {% endif %} {% if listing.photo_4 %}
        <div class="relative h-48 group cursor-pointer" onclick="openLightbox(4)">
          <img src="{{ listing.photo_4.url }}" alt="{{ listing.title }}"
            class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"
            onerror="this.onerror=null; this.src='https://picsum.photos/seed/p4_{{ listing.id }}/800/600'" />
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300 rounded-lg">
          </div>
          {% if listing.photo_5 or listing.photo_6 %}
          <div class="absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg">
            <span class="text-white text-lg font-semibold">
              +{% if listing.photo_5 and listing.photo_6 %}2{% else %}1{% endif %} more
            </span>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column - Property Details -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Property Overview -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
              Property Overview
            </h2>

            <!-- Amenities Grid -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
              <div class="flex items-center space-x-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl">
                <div
                  class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    {{ listing.bedrooms }}
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Bedroom{{ listing.bedrooms|pluralize }}
                  </p>
                </div>
              </div>

              <div class="flex items-center space-x-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl">
                <div class="w-10 h-10 bg-teal-100 dark:bg-teal-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    {{ listing.bathrooms }}
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Bathroom{{ listing.bathrooms|pluralize }}
                  </p>
                </div>
              </div>

              <div class="flex items-center space-x-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl">
                <div
                  class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z">
                    </path>
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    {{ listing.guests }}
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Guest{{ listing.guests|pluralize }}
                  </p>
                </div>
              </div>

              <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 4v10m6-10v10m-6 0h6"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    Premium
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Category
                  </p>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                About this place
              </h3>
              <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
                {{ listing.description }}
              </p>
            </div>
          </div>

          <!-- Host Information -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
              Meet Your Host
            </h2>

            <div class="flex items-start space-x-4">
              <img src="{{ listing.host.photo.url }}" alt="{{ listing.host.name }}"
                class="w-16 h-16 rounded-full object-cover"
                onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name={{ listing.host.name|urlencode }}&background=10b981&color=fff'" />
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                    {{ listing.host.name }}
                  </h3>
                  <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-200">
                    <i class="bi bi-patch-check-fill mr-1"></i>
                    Verified Host
                  </span>
                </div>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  {{ listing.host.description }}
                </p>

                <div class="flex items-center space-x-6 text-sm text-gray-500 dark:text-gray-400">
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 4v10m6-10v10m-6 0h6"></path>
                    </svg>
                    Host since 2020
                  </div>
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    4.9 rating
                  </div>
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                      </path>
                    </svg>
                    Fast response
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Property Details -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
              Property Details
            </h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700">
                <span class="text-gray-600 dark:text-gray-400">Property ID</span>
                <span class="font-medium text-gray-900 dark:text-white">#{{ listing.id }}</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700">
                <span class="text-gray-600 dark:text-gray-400">Listed</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ listing.list_date|date:"M d, Y" }}</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700">
                <span class="text-gray-600 dark:text-gray-400">Available from</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ listing.date_from|date:"M d, Y" }}</span>
              </div>
              <div class="flex justify-between items-center py-3 border-b border-gray-200 dark:border-gray-700">
                <span class="text-gray-600 dark:text-gray-400">Available until</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ listing.date_to|date:"M d, Y" }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Booking Card -->
        <div class="lg:col-span-1">
          <div class="sticky top-8">
            <div
              class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 p-8">
              <!-- Price Header -->
              <div class="flex items-center justify-between mb-6">
                <div>
                  <div class="flex items-baseline space-x-2">
                    <span class="text-3xl font-bold text-gray-900 dark:text-white">£{{ listing.price|intcomma }}</span>
                    <span class="text-gray-500 dark:text-gray-400">/ night</span>
                  </div>
                  <div class="flex items-center mt-1">
                    <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">4.8</span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 ml-1">(24 reviews)</span>
                  </div>
                </div>
                {% if user.is_authenticated %}
                <button id="heartButton" onclick="toggleSave()"
                  class="p-2 text-gray-400 hover:text-red-500 transition-colors">
                  {% else %}
                  <button onclick="showLoginPrompt('save')"
                    class="p-2 text-gray-400 hover:text-red-500 transition-colors">
                    {% endif %}
                    <svg id="heartIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                      </path>
                    </svg>
                  </button>
              </div>

              <!-- Contact Form -->
              <div class="space-y-4">
                {% if user.is_authenticated %}
                <button
                  class="w-full flex justify-center items-center gap-2 py-4 px-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition-all duration-300 shadow-lg shadow-emerald-600/20"
                  onclick="document.getElementById('contact_modal').showModal()">
                  {% else %}
                  <button
                    class="w-full flex justify-center items-center gap-2 py-4 px-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition-all duration-300 shadow-lg shadow-emerald-600/20"
                    onclick="showLoginPrompt('contact')">
                    {% endif %}
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                      </path>
                    </svg>
                    Contact Host
                  </button>

                  <div class="flex space-x-3">
                    <button onclick="openShareModal()"
                      class="flex-1 flex justify-center items-center gap-2 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z">
                        </path>
                      </svg>
                      Share
                    </button>
                    {% if user.is_authenticated %}
                    <button id="saveButton" onclick="toggleSave()"
                      class="flex-1 flex justify-center items-center gap-2 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                      {% else %}
                      <button onclick="showLoginPrompt('save')"
                        class="flex-1 flex justify-center items-center gap-2 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        {% endif %}
                        <svg id="saveIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        Save
                      </button>
                  </div>
              </div>

              <!-- Additional Info -->
              <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-center text-sm text-gray-500 dark:text-gray-400">
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                    </path>
                  </svg>
                  Your booking is protected
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Modal -->
  <div id="contact_modal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">
          Contact Host
        </h3>
        <button onclick="closeModal()"
          class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6">
        <!-- Host Info -->
        <div class="flex items-center space-x-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <img src="{{ listing.host.photo.url }}" alt="{{ listing.host.name }}"
            class="w-12 h-12 rounded-full object-cover"
            onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name={{ listing.host.name|urlencode }}&background=10b981&color=fff'" />
          <div>
            <h4 class="font-semibold text-gray-900 dark:text-white">
              {{ listing.host.name }}
            </h4>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Host since 2020
            </p>
          </div>
        </div>

        <!-- Contact Form -->
        <form action="{% url 'contact' %}" method="POST" class="space-y-4">
          {% csrf_token %} {% if user.is_authenticated %}
          <input type="hidden" name="user_id" value="{{ user.id }}" />
          {% else %}
          <input type="hidden" name="user_id" value="0" />
          {% endif %}
          <input type="hidden" name="host_email" value="{{ listing.host.email }}" />
          <input type="hidden" name="listing_id" value="{{ listing.id }}" />

          <div class="space-y-4">
            <div class="space-y-2">
              <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Your Name</label>
              {% if user.is_authenticated %}
              <input type="text" name="name" id="name" value="{{ user.first_name }} {{ user.last_name }}"
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                required />
              {% else %}
              <input type="text" name="name" id="name" placeholder="John Doe"
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                required />
              {% endif %}
            </div>

            <div class="space-y-2">
              <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email
                Address</label>
              {% if user.is_authenticated %}
              <input type="email" name="email" id="email" value="{{ user.email }}"
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                required />
              {% else %}
              <input type="email" name="email" id="email" placeholder="john@example.com"
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                required />
              {% endif %}
            </div>
          </div>

          <div class="space-y-2">
            <label for="listing" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Property</label>
            <input type="text" name="listing" id="listing" value="{{ listing.title }}"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-white"
              readonly />
          </div>

          <div class="space-y-2">
            <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Phone Number
              (Optional)</label>
            <input type="tel" name="phone" id="phone"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
          </div>

          <div class="space-y-2">
            <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Message</label>
            <textarea id="message" name="message" rows="4"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"
              placeholder="Hi, I'm interested in your property. Is it available for the dates I need?"
              required></textarea>
          </div>

          <!-- Modal Footer -->
          <div class="flex space-x-3 pt-4">
            <button type="button" onclick="closeModal()"
              class="flex-1 py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              Cancel
            </button>
            <button type="submit"
              class="flex-1 flex justify-center items-center gap-2 py-3 px-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold rounded-lg hover:from-emerald-700 hover:to-teal-700 transition-all duration-200">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
              </svg>
              Send Message
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="share_modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">
          Share this property
        </h3>
        <button onclick="closeShareModal()"
          class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6">
        <!-- Copy Link -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Property Link</label>
          <div class="flex gap-2">
            <input type="text" id="share-link" readonly value="{{ request.build_absolute_uri }}"
              class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-sm">
            <button onclick="copyLink()"
              class="px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                </path>
              </svg>
              Copy
            </button>
          </div>
          <p id="copy-feedback" class="text-sm text-emerald-600 dark:text-emerald-400 mt-2 hidden">
            ✓ Link copied to clipboard!
          </p>
        </div>

        <!-- Social Sharing -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Share via</label>
          <div class="grid grid-cols-2 gap-3">
            <!-- Facebook -->
            <button onclick="shareToSocial('facebook')"
              class="flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group">
              <svg class="w-5 h-5 text-[#1877F2]" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
              </svg>
              <span class="font-medium text-gray-700 dark:text-gray-300">Facebook</span>
            </button>

            <!-- Twitter -->
            <button onclick="shareToSocial('twitter')"
              class="flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group">
              <svg class="w-5 h-5 text-[#1DA1F2]" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
              </svg>
              <span class="font-medium text-gray-700 dark:text-gray-300">Twitter</span>
            </button>

            <!-- WhatsApp -->
            <button onclick="shareToSocial('whatsapp')"
              class="flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group">
              <svg class="w-5 h-5 text-[#25D366]" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
              </svg>
              <span class="font-medium text-gray-700 dark:text-gray-300">WhatsApp</span>
            </button>

            <!-- Email -->
            <button onclick="shareToSocial('email')"
              class="flex items-center justify-center gap-3 px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group">
              <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
              </svg>
              <span class="font-medium text-gray-700 dark:text-gray-300">Email</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Prompt Modal -->
  <div id="login_prompt_modal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8">
      <div class="text-center">
        <!-- Icon -->
        <div
          class="mx-auto w-16 h-16 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center mb-4">
          <svg class="w-8 h-8 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor"
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
            </path>
          </svg>
        </div>

        <!-- Title -->
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
          Sign in required
        </h3>

        <!-- Message -->
        <p id="login-prompt-message" class="text-gray-600 dark:text-gray-400 mb-6">
          Please sign in to save this listing
        </p>

        <!-- Buttons -->
        <div class="flex flex-col gap-3">
          <a href="{% url 'login' %}?next={{ request.path }}"
            class="w-full py-3 px-4 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors">
            Sign In
          </a>
          <a href="{% url 'register' %}"
            class="w-full py-3 px-4 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            Create Account
          </a>
          <button onclick="closeLoginPrompt()"
            class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Newsletter Section -->
  <section class="py-16 bg-gradient-to-br from-emerald-600 via-teal-600 to-emerald-700 relative overflow-hidden">
    <!-- Background Elements -->
    <div class="absolute inset-0 opacity-10">
      <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <pattern id="newsletter-grid" width="10" height="10" patternUnits="userSpaceOnUse">
            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5" />
          </pattern>
        </defs>
        <rect width="100" height="100" fill="url(#newsletter-grid)" />
      </svg>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative">
      <div data-aos="fade-up">
        <h2 class="text-3xl lg:text-4xl font-bold text-white mb-4">
          Stay Updated with Latest Properties
        </h2>
        <p class="text-xl text-white/90 max-w-2xl mx-auto mb-8 leading-relaxed">
          Join our community and receive notifications about new properties,
          special offers, and travel tips delivered straight to your inbox.
        </p>

        <div class="max-w-md mx-auto">
          <div class="flex flex-col sm:flex-row gap-3 bg-white/10 backdrop-blur-md rounded-2xl p-2">
            <input type="email" placeholder="Enter your email address"
              class="flex-1 px-4 py-3 bg-white/20 border-0 rounded-xl text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50" />
            <button
              class="px-6 py-3 bg-white text-emerald-600 font-semibold rounded-xl hover:bg-gray-100 transition-colors">
              Subscribe
            </button>
          </div>
          <p class="text-white/70 text-sm mt-3">
            No spam, unsubscribe at any time
          </p>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- JavaScript for Modal, Lightbox, Share, and Save -->
<script>
  // ===== Contact Modal =====
  function openModal() {
    document.getElementById("contact_modal").classList.remove("hidden");
    document.getElementById("contact_modal").classList.add("flex");
    document.body.style.overflow = "hidden";
  }

  function closeModal() {
    document.getElementById("contact_modal").classList.add("hidden");
    document.getElementById("contact_modal").classList.remove("flex");
    document.body.style.overflow = "auto";
  }

  // Close contact modal when clicking outside
  document
    .getElementById("contact_modal")
    .addEventListener("click", function (e) {
      if (e.target === this) {
        closeModal();
      }
    });

  // ===== Share Modal =====
  function openShareModal() {
    document.getElementById("share_modal").classList.remove("hidden");
    document.getElementById("share_modal").classList.add("flex");
    document.body.style.overflow = "hidden";
  }

  function closeShareModal() {
    document.getElementById("share_modal").classList.add("hidden");
    document.getElementById("share_modal").classList.remove("flex");
    document.body.style.overflow = "auto";
    // Hide copy feedback when closing
    document.getElementById("copy-feedback").classList.add("hidden");
  }

  // Close share modal when clicking outside
  document
    .getElementById("share_modal")
    .addEventListener("click", function (e) {
      if (e.target === this) {
        closeShareModal();
      }
    });

  // Copy link to clipboard
  function copyLink() {
    const linkInput = document.getElementById("share-link");
    linkInput.select();
    linkInput.setSelectionRange(0, 99999); // For mobile devices

    navigator.clipboard.writeText(linkInput.value).then(() => {
      // Show success feedback
      const feedback = document.getElementById("copy-feedback");
      feedback.classList.remove("hidden");

      // Show toast notification
      showToast("Link copied to clipboard!", "success");

      // Hide feedback after 3 seconds
      setTimeout(() => {
        feedback.classList.add("hidden");
      }, 3000);
    }).catch(err => {
      console.error("Failed to copy:", err);
      showToast("Failed to copy link", "error");
    });
  }

  // Share to social media
  function shareToSocial(platform) {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    let shareUrl = "";

    switch (platform) {
      case "facebook":
        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
        break;
      case "twitter":
        shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
        break;
      case "whatsapp":
        shareUrl = `https://wa.me/?text=${title}%20${url}`;
        break;
      case "email":
        shareUrl = `mailto:?subject=${title}&body=Check%20out%20this%20property:%20${url}`;
        break;
    }

    if (shareUrl) {
      window.open(shareUrl, "_blank", "width=600,height=400");
    }
  }

  // ===== Save Functionality (Database-backed) =====
  const LISTING_ID = "{{ listing.id }}";
  const IS_AUTHENTICATED = {{ user.is_authenticated| lower }};

  function toggleSave() {
    if (!IS_AUTHENTICATED) {
      showLoginPrompt('save');
      return;
    }

    // Show loading state
    const saveButton = document.getElementById("saveButton");
    const heartButton = document.getElementById("heartButton");
    if (saveButton) saveButton.disabled = true;
    if (heartButton) heartButton.disabled = true;

    // AJAX call to backend
    fetch(`/listings/save/${LISTING_ID}/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': getCookie('csrftoken'),
        'Content-Type': 'application/json',
      },
      credentials: 'same-origin'
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          updateSaveUI(data.saved);
          showToast(data.message, data.saved ? 'success' : 'info');
        } else {
          showToast(data.error || 'Failed to save listing', 'error');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('Failed to save listing', 'error');
      })
      .finally(() => {
        if (saveButton) saveButton.disabled = false;
        if (heartButton) heartButton.disabled = false;
      });
  }

  function updateSaveUI(isSaved) {
    // Update heart icon
    const heartIcon = document.getElementById("heartIcon");
    const heartButton = document.getElementById("heartButton");
    if (heartIcon && heartButton) {
      if (isSaved) {
        heartIcon.setAttribute("fill", "currentColor");
        heartButton.classList.remove("text-gray-400");
        heartButton.classList.add("text-red-500");
      } else {
        heartIcon.setAttribute("fill", "none");
        heartButton.classList.remove("text-red-500");
        heartButton.classList.add("text-gray-400");
      }
    }

    // Update save button icon
    const saveIcon = document.getElementById("saveIcon");
    const saveButton = document.getElementById("saveButton");
    if (saveIcon && saveButton) {
      if (isSaved) {
        saveIcon.setAttribute("fill", "currentColor");
        saveButton.classList.add("border-emerald-600", "dark:border-emerald-500", "text-emerald-600", "dark:text-emerald-400");
        saveButton.classList.remove("border-gray-300", "dark:border-gray-600", "text-gray-700", "dark:text-gray-300");
      } else {
        saveIcon.setAttribute("fill", "none");
        saveButton.classList.remove("border-emerald-600", "dark:border-emerald-500", "text-emerald-600", "dark:text-emerald-400");
        saveButton.classList.add("border-gray-300", "dark:border-gray-600", "text-gray-700", "dark:text-gray-300");
      }
    }
  }

  function initSavedListings() {
    if (!IS_AUTHENTICATED) {
      return; // Not logged in, nothing to load
    }

    // Fetch saved status from backend
    fetch(`/listings/saved-status/${LISTING_ID}/`, {
      credentials: 'same-origin'
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          updateSaveUI(data.saved);
        }
      })
      .catch(error => {
        console.error('Error fetching saved status:', error);
      });
  }

  // ===== Login Prompt =====
  function showLoginPrompt(action) {
    const modal = document.getElementById("login_prompt_modal");
    const message = document.getElementById("login-prompt-message");

    const messages = {
      'save': 'Please sign in to save this listing',
      'share': 'Please sign in to share this property',
      'contact': 'Please sign in to contact the host'
    };

    message.textContent = messages[action] || 'Please sign in to continue';
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    document.body.style.overflow = "hidden";
  }

  function closeLoginPrompt() {
    const modal = document.getElementById("login_prompt_modal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    document.body.style.overflow = "auto";
  }

  // Close login prompt when clicking outside
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById("login_prompt_modal");
    if (modal) {
      modal.addEventListener("click", function (e) {
        if (e.target === this) {
          closeLoginPrompt();
        }
      });
    }
  });

  // CSRF Token helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // ===== Toast Notification System =====
  function showToast(message, type = "info") {
    const toastContainer = document.getElementById("toast-container");

    // Create toast element
    const toast = document.createElement("div");
    toast.className = `flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${type === "success"
      ? "bg-emerald-600 text-white"
      : type === "error"
        ? "bg-red-600 text-white"
        : "bg-gray-800 dark:bg-gray-700 text-white"
      }`;

    // Add icon based on type
    const icon =
      type === "success"
        ? `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`
        : type === "error"
          ? `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`
          : `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;

    toast.innerHTML = `
      ${icon}
      <span class="font-medium">${message}</span>
    `;

    toastContainer.appendChild(toast);

    // Trigger animation
    setTimeout(() => {
      toast.classList.remove("translate-x-full");
      toast.classList.add("translate-x-0");
    }, 10);

    // Auto remove after 3 seconds
    setTimeout(() => {
      toast.classList.remove("translate-x-0");
      toast.classList.add("translate-x-full");
      setTimeout(() => {
        toastContainer.removeChild(toast);
      }, 300);
    }, 3000);
  }

  // ===== Lightbox =====
  function openLightbox(index) {
    // Lightbox functionality can be implemented here
    console.log("Opening lightbox for image:", index);
  }

  // ===== Initialize on page load =====
  document.addEventListener("DOMContentLoaded", function () {
    initSavedListings();
  });
</script>

<!-- Toast Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>


{% endblock %}